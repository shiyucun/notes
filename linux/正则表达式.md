
# 正则表达式

- [正则表达式](#正则表达式)
  - [普通字符](#普通字符)
  - [非打印字符](#非打印字符)
  - [特殊字符](#特殊字符)
  - [限定符](#限定符)
  - [定位符](#定位符)
  - [选择](#选择)
  - [反向引用](#反向引用)
  - [元字符](#元字符)
  - [运算符优先级](#运算符优先级)
  - [匹配规则](#匹配规则)
  - [替换和分组](#替换和分组)
  - [其他示例](#其他示例)

正则表达式的组件可以是单个的字符、字符集合、字符范围、字符间的选择或者所有这些组件的任意组合。

正则表达式是由普通字符(如字符`a`到`z`)、特殊字符(元字符)组成的文字模式。

模式描述在搜索文本时要匹配的一个或多个字符串。

正则表达式作为一个模板，将某个字符模式与所搜索的字符串进行匹配。

## 普通字符

普通字符包括没有显式指定为元字符的所有可打印和不可打印字符。

这包括所有大写和小写字母、所有数字、所有标点符号和一些其他符号。

## 非打印字符

非打印字符也可以是正则表达式的组成部分。如下：

| 字符 | 说明                 |
| ---- | ------------------ |
| \cx  | 匹配由x指明的控制字符。x的值必须为字母。否则，将`c`视为一个原义的`c`字符。 |
| \f   | 匹配一个换页符。等价于`\x0c`和`\cL`。                                          |
| \n   | 匹配一个换行符。等价于`\x0a`和`\cJ`。                                          |
| \r   | 匹配一个回车符。等价于`\x0d`和`\cM`。                                          |
| \s   | 匹配任何空白字符，包括空格、制表符、换页符等等。等价于`[ \f\n\r\t\v]`。        |
| \S   | 匹配任何非空白字符。等价于`[^ \f\n\r\t\v]`。                                   |
| \t   | 匹配一个制表符。等价于`\x09`和`\cI`。                                          |
| \v   | 匹配一个垂直制表符。等价于`\x0b`和`\cK`。                                      |

## 特殊字符

所谓特殊字符，就是一些有特殊含义的字符。如下：

| 字符 | 说明                  |
| ---- | ------------------- |
|$  | 匹配输入字符串的结尾位置。<br>如果设置了RegExp对象的Multiline属性，则`$`也匹配`\n`或`\r`。<br>要匹配`$`字符本身，请使用`\$`。|
|( ) | 标记一个子表达式的开始和结束位置。<br>子表达式可以获取供以后使用。<br>要匹配这些字符，请使用`\(`和`\)`。|
|*  | 匹配前面的子表达式零次或多次。<br>要匹配`*`字符，请使用`\*`。|
|+  | 匹配前面的子表达式一次或多次。<br>要匹配`+`字符，请使用`\+`。|
|.  | 匹配除换行符之外的任何单字符。<br>要匹配`.`字符，请使用`\.`。|
|[  | 标记一个中括号表达式的开始。<br>要匹配`[`字符，请使用`\[`。|
|?  | 匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。<br>要匹配`?`字符，请使用`\?`。|
|\  | 将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。<br>例如：`n`匹配字符`n`；`\n` 匹配换行符；序列 `\\` 匹配 `\`；`\(` 则匹配 `(`。
|^  | 匹配输入字符串的开始位置，除非在方括号表达式中使用，此时它表示不接受该字符集合。<br> 要匹配`^`字符本身，请使用`\^`。|
|{  | 标记限定符表达式的开始。<br>要匹配`{`，请使用`\{`。
|\| | 指明两项之间的一个选择。<br> 要匹配`|`，请使用`\|`。|

## 限定符

限定符用来指定正则表达式的一个给定组件必须要出现多少次才能满足匹配。

正则表达式的限定符有以下六种：

| 字符 | 说明                  |
| ---- | ------------------- |
|*  | 匹配前面的子表达式零次或多次，等价于`{0,}`。<br>例如：`zo*`能匹配`z`以及`zoo`。|
|+  | 匹配前面的子表达式一次或多次，等价于`{1,}`。<br>例如，`zo+`能匹配`zo`以及`zoo`，但不能匹配`z`。|
|?  | 匹配前面的子表达式零次或一次。等价于`{0,1}`。<br>例如，`do(es)?`可以匹配`do`、`does`中的`does`、`doxy`中的`do`。
|{n} | n是一个非负整数，匹配确定的n次。<br>例如，`o{2}`不能匹配`Bob`中的`o`，但是能匹配`food`中的两个`o`。
|{n,} | n是一个非负整数，至少匹配n次。<br>例如，`o{2,}`不能匹配`Bob`中的`o`，但能匹配 `foooood` 中的所有`o`。<br>`o{1,}`等价于 `o+`。`o{0,}`则等价于`o*`。|
|{n,m} | m和n均为非负整数，其中 n<=m，最少匹配n次且最多匹配m次。<br>例如，`o{1,3}`将匹配`fooooood`中的前三个`o`。<br>`o{0,1}`等价于`o?`。<br>注意：在逗号和两个数之间不能有空格。|

## 定位符

定位符能够将正则表达式固定到行首或行尾。如下：

| 字符 | 说明                  |
| ---- | ------------------- |
|^ | 匹配输入字符串开始的位置。<br>如果设置了RegExp对象的Multiline属性，`^`还会与`\n`或`\r`之后的位置匹配。|
|$ | 匹配输入字符串结尾的位置。<br>如果设置了RegExp对象的Multiline属性，`$`还会与`\n`或`\r`之前的位置匹配。|
|b | 匹配一个字边界，即字与空白字符间的位置。|
|B | 非字边界匹配。|

注意：

1. 不能将限定符与定位符一起使用
2. 紧靠换行或者字边界的前后不能有一个以上位置，因此不允许诸如`^*`之类的表达式
3. 若要匹配一行文本开始处的文本，请在正则表达式的开始使用`^`字符。
4. 不要将`^`的定位符用法与中括号表达式内的用法混淆
5. 若要匹配一行文本结束处的文本，请在正则表达式的结束处使用`$`字符

## 选择

用圆括号将所有选择项括起来，相邻的选择项之间用`|`分隔。

圆括号会使相关的匹配被缓存，可用`?:`放在第一个选项前来消除这种副作用。

`?:`是非捕获元之一，还有两个非捕获元是`?=`和`?!`。

`?=`为正向预查，在任何开始匹配圆括号内的正则表达式模式的位置来匹配搜索字符串。

`?!`为负向预查，在任何开始不匹配该正则表达式模式的位置来匹配搜索字符串。

## 反向引用

对一个正则表达式模式或部分模式的两边添加圆括号将导致相关匹配存储到一个临时缓冲区中。

所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。

缓冲区编号从1开始，最多可存储99个捕获的子表达式。

每个缓冲区都可以使用`\n`访问，其中n为一个标识特定缓冲区的一位或两位十进制数。

可以使用非捕获元字符`?:`、`?=`、`?!`来重写捕获，忽略对相关匹配的保存。

反向引用的最简单的、最有用的应用之一，是提供查找文本中两个相同的相邻单词的匹配项的能力。

## 元字符

如下表：

| 字符 | 说明                  |
| ---- | ------------------- |
|\\ | 将下一个字符标记为特殊字符、原义字符、向后引用或八进制转义符。如：<br>`n`匹配字符`n`，`\n`匹配一个换行符。<br>序列 `\\`匹配`\`，`\(` 则匹配`(`。|
|^ | 匹配输入字符串的开始位置。<br>如果设置了RegExp对象的Multiline属性，`^`也匹配`\n`或`\r`之后的位置。|
|$ | 匹配输入字符串的结束位置。<br>如果设置了RegExp对象的Multiline属性，`$`也匹配`\n`或`\r`之前的位置。|
|* | 匹配前面的子表达式零次或多次。如：<br>`zo*`能匹配`z`以及`zoo`。`*`等价于`{0,}`。|
|+ | 匹配前面的子表达式一次或多次。如：<br>`zo+`能匹配`zo`以及`zoo`，但不能匹配`z`。`+`等价于`{1,}`。|
|? | 匹配前面的子表达式零次或一次。如：<br>`do(es)?`可以匹配`do`或`does`。`\?`等价于`{0,1}`。|
|? | 紧跟在一个其他限制符(`*`,`+`,`?`,`{n}`,`{n,}`,`{n,m}`)后面时，匹配模式是非贪婪的。<br>非贪婪模式尽可能少的匹配，默认的贪婪模式会尽可能多的匹配。如：<br>对于字符串`oooo`，`o+?`将匹配单个`o`，而`o+`将匹配所有`o`。|
|{n} | n是一个非负整数。匹配确定的n次。如：<br>`o{2}`不能匹配`Bob`中的`o`，但是能匹配`food`中的两个`o`。|
|{n,} | n是一个非负整数。至少匹配n次。如：<br>`o{2,}`不能匹配`Bob`中的`o`，但能匹配`foooood`中的所有`o`。<br>`o{1,}`等价于`o+`。`o{0,}`则等价于`o*`。|
|{n,m} | m和n均为非负整数，其中 n<=m。最少匹配n次且最多匹配m次。如：<br>`o{1,3}`将匹配`fooooood`中的前三个`o`。<br>`o{0,1}`等价于`o?`。<br>注意在逗号和两个数之间不能有空格。|
|.| 匹配除`\n`之外的任何单个字符。要匹配包括`\n`在内的任何字符，请使用`(.|n)`。|
|(pattern) | 匹配`pattern`并获取这一匹配。<br>所获取的匹配可以从产生的Matches集合得到。<br>使用`\(`或`\)`匹配`(`或`)`。|
|(?:pattern) | 匹配`pattern`但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。<br>使用`|`来组合一个模式的各个部分时是很有用。如：<br>`industr(?:y|ies)`就是一个比`industry|industries`更简略的表达式。|
|(?=pattern) | 正向肯定预查，在任何匹配`pattern`的字符串开始处匹配查找字符串。<br>非获取匹配，即该匹配不需要获取供以后使用。如：<br>`Win(?=95\|98\|NT\|2000)`匹配`Win95`中的`Win`，不匹配`Win3.1`的`Win`。<br>预查不消耗字符，即在匹配发生后，在最后一次匹配后立即开始下次匹配。
|(?!pattern) | 正向否定预查，在任何不匹配`pattern`的字符串开始处匹配查找字符串。<br>非获取匹配，即该匹配不需要获取供以后使用。如：<br>`Win(?!95\|98\|NT\|2000)`匹配`Win3.1`中的`Win`，不匹配`Win2000`中的`Win`。<br>预查不消耗字符，即在匹配发生后，在最后一次匹配后立即开始下一次匹配的搜索。|
|(?<=pattern) | 反向肯定预查，与正向肯定预查类似，只是方向相反。如：<br>`(?<=95\|98\|NT\|2000)Win`匹配`2000Win`中的`Win`，不匹配`3.1Win`中的`Win`。|
|(?<!pattern) | 反向否定预查，与正向否定预查类似，只是方向相反。例：<br>`(?<!95\|98\|NT\|2000)Win`匹配`3.1Win`中的`Win`，不匹配`2000Win`中的`Win`。|
|x\|y | 匹配x或y。如：<br>`z|food`匹配`z`或`food`。<br>`(z|f)ood`匹配`zood`或`food`。|
|[xyz] | 字符集合。匹配包含的任意一个字符。如：<br>`[abc]`匹配`plain`中的`a`。|
|[^xyz]| 负值字符集合。匹配未包含的任意字符。如：<br>`[^abc]`匹配`plain`中的`p`、`l`、`i`、`n`。|
|[a-z] | 字符范围。匹配指定范围内的任意字符。如：<br>`[a-z]`匹配`a`到`z`范围内的任意小写字母。|
|[^a-z] | 负值字符范围。匹配任何不在指定范围内的任意字符。如：<br>`[^a-z]`匹配任何不在`a`到`z`范围内的任意字符。|
|\b | 匹配一个单词边界，也就是指单词和空格间的位置。如：<br>`er\b`匹配`never`中的`er`，不匹配`verb`中的`er`。|
|\B | 匹配非单词边界。如：<br>`er\B`匹配`verb`中的`er`，不匹配`never`中的`er`。|
|\cx | 匹配`x`指明的控制字符。如：<br>`\cM`匹配一个`Control-M`或回车符。<br>`x`的值必须为`A-Z`或`a-z`之一。否则，将`c`视为一个原义字符。|
|\d | 匹配一个数字字符。等价于[0-9]。|
|\D | 匹配一个非数字字符。等价于[^0-9]。|
|\f | 匹配一个换页符。等价于`\x0c`和`\cL`。|
|\n | 匹配一个换行符。等价于`\x0a`和`\cJ`。|
|\r | 匹配一个回车符。等价于`\x0d`和`\cM`。|
|\s | 匹配任何空白字符，包括空格、制表符、换页符等。等价于`[ \f\n\r\t\v]`。|
|\S | 匹配任何非空白字符。等价于`[^ \f\n\r\t\v]`。|
|\t | 匹配一个制表符。等价于`\x09`和`\cI`。|
|\v | 匹配一个垂直制表符。等价于`\x0b`和`\cK`。|
|\w | 匹配字母、数字、下划线。等价于`[A-Za-z0-9_]`。|
|\W | 匹配非字母、数字、下划线。等价于`[^A-Za-z0-9_]`。|
|\xn | 匹配 n，其中n为十六进制转义值。十六进制转义值必须为确定的两个数字长。如：<br>`\x41`匹配`A`。`\x041`等价于`\x04`& `1`。<br>正则表达式中可以使用ASCII编码。
|\num | 匹配num，其中num是一个正整数。对所获取的匹配的引用。如：<br>`(.)\1`匹配两个连续的相同字符。|
|\n | 标识一个八进制转义值或一个向后引用。<br>如果`\n`之前至少n个获取的子表达式，则n为向后引用。<br>否则，如果n为八进制数字，则n为一个八进制转义值。|
|\nm | 标识一个八进制转义值或一个向后引用。<br>如果`\nm`之前至少有nm个获取的子表达式，则nm为向后引用。<br>如果`\nm`之前至少有n个获取，则n为一个后跟文字m的向后引用。<br>如果前面的条件都不满足，若n和m均为八进制数字，则`\nm`将匹配八进制转义值nm。|
|\nml| 如果n为八进制数字(0-3)，且m和l均为八进制数字(0-7)，则匹配八进制转义值nml。|
|\un | 匹配n，其中n是一个用四个十六进制数字表示的Unicode字符。如：<br>`\u00A9`匹配版权符号(?)。|

## 运算符优先级

正则表达式从左到右进行计算，并遵循优先级顺序，这与算术表达式非常类似。

相同优先级的从左到右进行运算，不同优先级的运算先高后低。

下表从最高到最低说明了各种正则表达式运算符的优先级顺序：

| 运算符 | 说明                |
| ---- | ------------------- |
| \\ | 转义符 |
| ()、( ?: )、( ?= )、[] | 圆括号和方括号 |
| *, +, ?, {n}, {n,}, {n,m} | 限定符 |
| ^, $, \任何元字符,任何字符 | 定位点和序列(即：位置和顺序) |
| \| | 替换，或操作。<br>`|`字符具有高于替换运算符的优先级，使得`m|food`匹配`m`或`food`。<br>若要匹配`mood`或`food`，请使用括号创建子表达式，从而产生`(m|f)ood`。|

## 匹配规则

模式，是正则表达式最基本的元素，它们是一组描述字符串特征的字符。

模式可以很简单，由普通的字符串组成。

模式也可以非常复杂，往往用特殊的字符表示一个范围内的字符、重复出现，或表示上下文。

如：

- `^start`，只匹配`start`开头的字符串
- `end$`，只匹配`end`结尾的字符串
- `^startend$`，精确匹配(字符串与模式一样)，只匹配字符串`startend`

如果一个模式不包括`^`和`$`，那么它与任何包含该模式的字符串匹配。

所有的转义序列都以`\`开头。

制表符的转义序列是：`\t`。

所以如果我们要检测一个字符串是否以制表符开头，可以用这个模式：`^\t`。

在 internet 程序中，正则表达式通常用来验证用户的输入。

- `^[a-zA-Z_]$`：所有的字母和下划线
- `^[a-zA-Z]{3}$`：所有的3个字母的单词
- `^a$`：字母a
- `^a{4}$`：字符串aaaa
- `^a{2,4}$`：字符串aa、aaa、aaaa
- `^a{1,3}$`：字母a，字符串aa、aaa
- `^a{2,}$`：字符串全为a且长度大于2
- `^a{2,}`：以至少2个a开头的字符串
- `a{2,}`：包含至少两个连续字符a的字符串
- `\t{2}`：2个制表符
- `.{2}`：所有的两个字符

以上示例描述了花括号的三种不同的用法：

1. `{x}`：前面的字符或字符簇只出现x次
2. `{x,}`：前面的内容出现x或更多的次数
3. `{x,y}`：前面的内容至少出现x次，但不超过y次

- `^[a-zA-Z0-9_]{1,}$`：包含一个以上的字母、数字或下划线的字符串
- `^[1-9][0-9]{0,}$`：正整数
- `^-{0,1}[0-9]{1,}$`：整数
- `^[-]?[0-9]+.?[0-9]+$`：浮点数
  - `[-]?`：标识负号可选
  - `[0-9]+`：一个或多个数字
  - ? 与 {0,1} 等价，代表0或1个前面的内容，因此浮点数可简化为：`^-?[0-9]{1,}.?[0-9]{1,}$`

特殊字符`*`与`{0,}`是相等的，代表0个或多个前面的内容。
特殊字符`+`与`{1,}`是相等的，表示1个或多个前面的内容，所以上面的4个例子可以写成：

- `^[a-zA-Z0-9_]+$`：包含一个以上的字母、数字或下划线的字符串
- `^[1-9][0-9]*$`：正整数  
- `^-?[0-9]+$`：整数  
- `^-?[0-9]+.?[0-9]*$`：浮点数

特殊字符句点 (.) 匹配字符串中的各种打印或非打印字符，只有换行符 (\n) 例外。

若要创建匹配字符组的一个列表，要在方括号（[]）内放置一个或更多单个字符。

当字符括在中括号内时，该列表称为"中括号表达式"。

与在任何别的位置一样，普通字符在中括号内表示其本身，即在输入文本中匹配一次其本身。

括在中括号表达式中的字符只匹配处于正则表达式中该位置的单个字符。如：

- `Chapter [12]`：可以匹配`Chapter 1`、`Chapter 2`
- `Chapter [1-3]`：可以匹配`Chapter 1`、`Chapter 2`、`Chapter 3`

若要查找不在列表或范围内的所有字符，则可以将插入符号 (^) 放在列表的开头。

如果插入字符出现在列表中的其他任何位置，则它匹配其本身。

中括号表达式的典型用途是指定任何大写或小写字母或任何数字的匹配。

## 替换和分组

替换使用字符`|`，允许在两个或多个替换选项之间进行选择。

若要使正则表达式更易于控制，可以使用括号来限制替换的范围，如：

`^(Chapter|Section) [1-9][0-9]{0,1}$`：确保只应用于两个单词`Chapter`和`Section`。

括号也用于创建子表达式，并可能捕获它们供以后使用。

在上面的示例中若要防止匹配被保存，则应在括号内正则表达式模式之前放置`?:`。如下：

`^(?:Chapter|Section) [1-9][0-9]{0,1}$`

## 其他示例

- `\b([a-z]+) \1\b`：一个单词连续出现的位置
- `(\w+)://([^/:]+)(:\d*)?([^# ]*)`：将一个URL解析为协议、域、端口及相对路径。
- `^(?:Chapter|Section) [1-9][0-9]{0,1}$`：定位章节位置
- `[-a-z]`：a至z共26个字母再加一个-号
- `ter\b`：可匹配`chapter`，而不能匹配`terminal`
- `\Bapt`：可匹配`chapter`，而不能匹配`aptitude`
- `Windows(?=95|98|NT)`：可匹配`Windows95`或`Windows98`或`WindowsNT`
  - 当找到一个匹配后，从Windows后面开始进行下一次的检索匹配。
- `^\s*$`：匹配空行
- `\d{2}-\d{5}`：验证由两位数字、一个连字符再加5位数字组成的ID号
- `<\s*(\S+)(\s[^>]*)?>[\s\S]*<\s*\/\1\s*>`：匹配HTML标记
